{% comment %}
  XML Sitemap Template for SEO
  Generates a sitemap for search engines including all properties and pages
{% endcomment %}
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
        xmlns:image="http://www.google.com/schemas/sitemap-image/1.1">
  
  {%- comment -%} Homepage {%- endcomment -%}
  <url>
    <loc>{{ shop.url }}</loc>
    <lastmod>{{ 'now' | date: '%Y-%m-%d' }}</lastmod>
    <changefreq>daily</changefreq>
    <priority>1.0</priority>
    {%- if settings.hero_image -%}
    <image:image>
      <image:loc>{{ settings.hero_image | image_url: width: 1200 }}</image:loc>
      <image:title>{{ settings.hero_title | default: shop.name }}</image:title>
    </image:image>
    {%- endif -%}
  </url>

  {%- comment -%} Collections (Property Categories) {%- endcomment -%}
  {%- for collection in collections -%}
    {%- unless collection.handle == 'frontpage' -%}
    <url>
      <loc>{{ collection.url | prepend: shop.url }}</loc>
      <lastmod>{{ collection.updated_at | date: '%Y-%m-%d' }}</lastmod>
      <changefreq>weekly</changefreq>
      <priority>0.8</priority>
      {%- if collection.featured_image -%}
      <image:image>
        <image:loc>{{ collection.featured_image | image_url: width: 1200 }}</image:loc>
        <image:title>{{ collection.title }}</image:title>
        <image:caption>{{ collection.description | strip_html | truncate: 160 }}</image:caption>
      </image:image>
      {%- endif -%}
    </url>
    {%- endunless -%}
  {%- endfor -%}

  {%- comment -%} Products (Properties) {%- endcomment -%}
  {%- for product in collections.all.products -%}
    <url>
      <loc>{{ product.url | prepend: shop.url }}</loc>
      <lastmod>{{ product.updated_at | date: '%Y-%m-%d' }}</lastmod>
      <changefreq>monthly</changefreq>
      <priority>0.9</priority>
      
      {%- comment -%} Property Images {%- endcomment -%}
      {%- for image in product.images limit: 10 -%}
      <image:image>
        <image:loc>{{ image | image_url: width: 1200 }}</image:loc>
        <image:title>{% if image.alt != blank %}{{ image.alt }}{% else %}{{ product.title }} - Imagen {{ forloop.index }}{% endif %}</image:title>
        <image:caption>{{ product.description | strip_html | truncate: 160 }}</image:caption>
        {%- if product.metafields.custom.location -%}
        <image:geo_location>{{ product.metafields.custom.location }}</image:geo_location>
        {%- endif -%}
      </image:image>
      {%- endfor -%}
    </url>
  {%- endfor -%}

  {%- comment -%} Static Pages {%- endcomment -%}
  {%- for page in pages -%}
    {%- unless page.handle == 'frontpage' -%}
    <url>
      <loc>{{ page.url | prepend: shop.url }}</loc>
      <lastmod>{{ page.updated_at | date: '%Y-%m-%d' }}</lastmod>
      <changefreq>monthly</changefreq>
      <priority>0.6</priority>
    </url>
    {%- endunless -%}
  {%- endfor -%}

  {%- comment -%} Blog Posts (if any) {%- endcomment -%}
  {%- for blog in blogs -%}
    <url>
      <loc>{{ blog.url | prepend: shop.url }}</loc>
      <lastmod>{{ blog.updated_at | date: '%Y-%m-%d' }}</lastmod>
      <changefreq>weekly</changefreq>
      <priority>0.7</priority>
    </url>
    
    {%- for article in blog.articles -%}
    <url>
      <loc>{{ article.url | prepend: shop.url }}</loc>
      <lastmod>{{ article.updated_at | date: '%Y-%m-%d' }}</lastmod>
      <changefreq>monthly</changefreq>
      <priority>0.6</priority>
      {%- if article.image -%}
      <image:image>
        <image:loc>{{ article.image | image_url: width: 1200 }}</image:loc>
        <image:title>{{ article.title }}</image:title>
        <image:caption>{{ article.summary | default: article.excerpt | strip_html | truncate: 160 }}</image:caption>
      </image:image>
      {%- endif -%}
    </url>
    {%- endfor -%}
  {%- endfor -%}

</urlset>
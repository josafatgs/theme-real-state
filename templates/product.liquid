<div class="property-detail">
  <div class="container">
    <!-- Property Header -->
    <div class="property-header">
      <nav class="breadcrumb">
        <a href="{{ routes.root_url }}">Inicio</a>
        <span>/</span>
        <a href="/collections/propiedades">Propiedades</a>
        <span>/</span>
        <span>{{ product.title }}</span>
      </nav>
      
      <h1 class="property-title">{{ product.title }}</h1>
      
      {% if product.metafields.custom.location %}
        <p class="property-location">
          üìç {{ product.metafields.custom.location }}
        </p>
      {% endif %}
      
      <div class="property-price">
        <span class="price-amount">{{ product.price | money }}</span>
      </div>
    </div>

    <!-- Image Gallery -->
    <div class="property-gallery">
      {% if product.images.size > 0 %}
        <div class="main-image">
          <img src="{{ product.featured_image | img_url: '800x600' }}" alt="{{ product.title }}" id="mainImage">
        </div>
        
        {% if product.images.size > 1 %}
          <div class="gallery-thumbnails">
            {% for image in product.images limit: 8 %}
              <img 
                src="{{ image | img_url: '120x90' }}" 
                alt="{{ product.title }} - Imagen {{ forloop.index }}"
                class="thumbnail{% if forloop.first %} active{% endif %}"
                onclick="changeMainImage('{{ image | img_url: '800x600' }}')"
              >
            {% endfor %}
          </div>
        {% endif %}
      {% else %}
        <div class="no-image">
          <p>Sin im√°genes disponibles</p>
        </div>
      {% endif %}
    </div>

    <!-- Property Specifications -->
    <div class="property-specs">
      <h2>Especificaciones</h2>
      
      <div class="specs-grid">
        {% if product.metafields.custom.bedrooms %}
          <div class="spec-item">
            <span class="spec-icon">üõèÔ∏è</span>
            <span class="spec-label">Rec√°maras</span>
            <span class="spec-value">{{ product.metafields.custom.bedrooms }}</span>
          </div>
        {% endif %}
        
        {% if product.metafields.custom.bathrooms %}
          <div class="spec-item">
            <span class="spec-icon">üöø</span>
            <span class="spec-label">Ba√±os</span>
            <span class="spec-value">{{ product.metafields.custom.bathrooms }}</span>
          </div>
        {% endif %}
        
        {% if product.metafields.custom.square_meters %}
          <div class="spec-item">
            <span class="spec-icon">üìê</span>
            <span class="spec-label">√Årea</span>
            <span class="spec-value">{{ product.metafields.custom.square_meters }} m¬≤</span>
          </div>
        {% endif %}
        
        {% if product.metafields.custom.parking_spaces %}
          <div class="spec-item">
            <span class="spec-icon">üöó</span>
            <span class="spec-label">Estacionamiento</span>
            <span class="spec-value">{{ product.metafields.custom.parking_spaces }} espacio{% if product.metafields.custom.parking_spaces != 1 %}s{% endif %}</span>
          </div>
        {% endif %}
        
        {% if product.metafields.custom.property_type %}
          <div class="spec-item">
            <span class="spec-icon">üè†</span>
            <span class="spec-label">Tipo</span>
            <span class="spec-value">{{ product.metafields.custom.property_type | capitalize }}</span>
          </div>
        {% endif %}
        
        {% if product.metafields.custom.year_built %}
          <div class="spec-item">
            <span class="spec-icon">üìÖ</span>
            <span class="spec-label">A√±o de construcci√≥n</span>
            <span class="spec-value">{{ product.metafields.custom.year_built }}</span>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Property Description -->
    {% if product.description != blank %}
      <div class="property-description">
        <h2>Descripci√≥n</h2>
        <div class="description-content">
          {{ product.description }}
        </div>
      </div>
    {% endif %}

    <!-- Call to Action Buttons -->
    <div class="property-actions">
      <h2>¬øTe interesa esta propiedad?</h2>
      <div class="action-buttons">
        <a 
          href="https://wa.me/{{ settings.whatsapp_number | default: '521234567890' }}?text=Hola, me interesa la propiedad: {{ product.title | url_encode }} - {{ shop.url }}{{ product.url }}"
          target="_blank"
          class="btn btn--primary btn--whatsapp"
        >
          üì± Agendar Cita por WhatsApp
        </a>
        
        <a href="tel:{{ settings.phone_number | default: '+52 123 456 7890' }}" class="btn btn--secondary">
          üìû Llamar Ahora
        </a>
      </div>
    </div>

  </div>
</div>

<script>
// Funci√≥n para cambiar la imagen principal
function changeMainImage(imageSrc) {
  document.getElementById('mainImage').src = imageSrc;
  
  // Actualizar thumbnails activos
  const thumbnails = document.querySelectorAll('.thumbnail');
  thumbnails.forEach(thumb => thumb.classList.remove('active'));
  event.target.classList.add('active');
}
</script>% if product.images.size > 1 %}
          <button class="lightbox-nav lightbox-prev" aria-label="{{ 'product.gallery.previous' | t }}">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
            </svg>
          </button>
          
          <button class="lightbox-nav lightbox-next" aria-label="{{ 'product.gallery.next' | t }}">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
            </svg>
          </button>
        {% endif %}
      </div>
      
      <div class="lightbox-counter">
        <span id="lightboxCounter">1 / {{ product.images.size }}</span>
      </div>
    </div>
  </div>

  <!-- Product Data for JavaScript -->
  <script>
    window.product = {
      title: {{ product.title | json }},
      images: [
        {% for image in product.images %}
          {{ image | img_url: '1200x900' | json }}{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ]
    };
  </script>

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": {{ product.title | json }},
    "description": {{ product.description | strip_html | json }},
    "image": [
      {% for image in product.images limit: 5 %}
        {{ image | img_url: '800x600' | json }}{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ],
    "offers": {
      "@type": "Offer",
      "price": {{ product.price | divided_by: 100.0 | json }},
      "priceCurrency": {{ cart.currency.iso_code | json }},
      "availability": "https://schema.org/InStock",
      "url": {{ shop.url | append: product.url | json }}
    }{% if product.metafields.custom.city or product.metafields.custom.state or product.metafields.custom.postal_code %},
    "address": {
      "@type": "PostalAddress"{% if product.metafields.custom.city %},
      "addressLocality": {{ product.metafields.custom.city | json }}{% endif %}{% if product.metafields.custom.state %},
      "addressRegion": {{ product.metafields.custom.state | json }}{% endif %}{% if product.metafields.custom.postal_code %},
      "postalCode": {{ product.metafields.custom.postal_code | json }}{% endif %}{% if product.metafields.custom.neighborhood %},
      "streetAddress": {{ product.metafields.custom.neighborhood | json }}{% endif %}
    }{% endif %}{% if product.metafields.custom.square_meters %},
    "floorSize": {
      "@type": "QuantitativeValue",
      "value": {{ product.metafields.custom.square_meters | json }},
      "unitCode": "MTK"
    }{% endif %}{% if product.metafields.custom.bedrooms %},
    "numberOfRooms": {{ product.metafields.custom.bedrooms | json }}{% endif %}{% if product.metafields.custom.year_built %},
    "yearBuilt": {{ product.metafields.custom.year_built | json }}{% endif %}{% if product.metafields.custom.latitude and product.metafields.custom.longitude %},
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": {{ product.metafields.custom.latitude | json }},
      "longitude": {{ product.metafields.custom.longitude | json }}
    }{% endif %}
  }
  </script>
</article>

<!-- Include WhatsApp Float -->
{% render 'whatsapp-float' %}
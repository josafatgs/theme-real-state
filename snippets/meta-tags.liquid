{%- comment -%}
  Enhanced Meta tags for SEO and social sharing with structured data
{%- endcomment -%}

{%- assign og_title = page_title -%}
{%- assign og_url = canonical_url -%}
{%- assign og_type = 'website' -%}
{%- assign og_description = page_description | default: shop.description | default: shop.name -%}

{%- comment -%} Enhanced SEO Meta Tags {%- endcomment -%}
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
<meta name="googlebot" content="index, follow">
<meta name="bingbot" content="index, follow">

{%- comment -%} Geo Location Meta Tags {%- endcomment -%}
{%- if settings.business_country -%}
  <meta name="geo.region" content="{{ settings.business_country }}">
{%- endif -%}
{%- if settings.business_city -%}
  <meta name="geo.placename" content="{{ settings.business_city }}">
{%- endif -%}
{%- if settings.business_coordinates -%}
  <meta name="geo.position" content="{{ settings.business_coordinates }}">
  <meta name="ICBM" content="{{ settings.business_coordinates }}">
{%- endif -%}

{%- comment -%} Enhanced Product Meta Tags {%- endcomment -%}
{%- if template contains 'product' -%}
  {%- assign og_type = 'product' -%}
  {%- assign property_description = product.description | strip_html | truncate: 160 -%}
  {%- assign og_description = property_description | default: og_description -%}
  
  {%- comment -%} Product specific meta tags {%- endcomment -%}
  <meta name="product:price:amount" content="{{ product.price | divided_by: 100.0 }}">
  <meta name="product:price:currency" content="{{ cart.currency.iso_code }}">
  <meta name="product:availability" content="in stock">
  <meta name="product:condition" content="new">
  
  {%- if product.metafields.custom.property_type -%}
    <meta name="product:category" content="{{ product.metafields.custom.property_type }}">
  {%- endif -%}
  
  {%- if product.featured_media -%}
    <meta property="og:image" content="{{ product.featured_media | image_url: width: 1200, height: 630 }}">
    <meta property="og:image:secure_url" content="{{ product.featured_media | image_url: width: 1200, height: 630 }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="{{ product.featured_media.alt | default: product.title }}">
    
    {%- comment -%} Additional product images {%- endcomment -%}
    {%- for image in product.images limit: 4 -%}
      {%- unless forloop.first -%}
        <meta property="og:image" content="{{ image | image_url: width: 1200, height: 630 }}">
      {%- endunless -%}
    {%- endfor -%}
  {%- endif -%}
{%- endif -%}

{%- comment -%} Collection Meta Tags {%- endcomment -%}
{%- if template contains 'collection' -%}
  {%- assign collection_description = collection.description | strip_html | truncate: 160 -%}
  {%- assign og_description = collection_description | default: og_description -%}
  
  {%- if collection.featured_image -%}
    <meta property="og:image" content="{{ collection.featured_image | image_url: width: 1200, height: 630 }}">
    <meta property="og:image:secure_url" content="{{ collection.featured_image | image_url: width: 1200, height: 630 }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="{{ collection.featured_image.alt | default: collection.title }}">
  {%- endif -%}
{%- endif -%}

{%- comment -%} Homepage Meta Tags {%- endcomment -%}
{%- if template == 'index' -%}
  {%- assign og_type = 'website' -%}
  {%- if settings.hero_image -%}
    <meta property="og:image" content="{{ settings.hero_image | image_url: width: 1200, height: 630 }}">
    <meta property="og:image:secure_url" content="{{ settings.hero_image | image_url: width: 1200, height: 630 }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="{{ settings.hero_title | default: shop.name }}">
  {%- endif -%}
{%- endif -%}

{%- comment -%} Open Graph Meta Tags {%- endcomment -%}
<meta property="og:site_name" content="{{ shop.name }}">
<meta property="og:url" content="{{ og_url }}">
<meta property="og:title" content="{{ og_title }}">
<meta property="og:type" content="{{ og_type }}">
<meta property="og:description" content="{{ og_description }}">
<meta property="og:locale" content="{{ request.locale.iso_code }}">

{%- if settings.social_facebook_link != blank -%}
  <meta property="article:author" content="{{ settings.social_facebook_link }}">
  <meta property="fb:admins" content="{{ settings.facebook_admin_id }}">
{%- endif -%}

{%- comment -%} Twitter Card Meta Tags {%- endcomment -%}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@{{ settings.social_twitter_handle | remove: '@' }}">
<meta name="twitter:creator" content="@{{ settings.social_twitter_handle | remove: '@' }}">
<meta name="twitter:title" content="{{ og_title }}">
<meta name="twitter:description" content="{{ og_description }}">

{%- if template contains 'product' and product.featured_media -%}
  <meta name="twitter:image" content="{{ product.featured_media | image_url: width: 1200, height: 630 }}">
  <meta name="twitter:image:alt" content="{{ product.featured_media.alt | default: product.title }}">
{%- elsif template contains 'collection' and collection.featured_image -%}
  <meta name="twitter:image" content="{{ collection.featured_image | image_url: width: 1200, height: 630 }}">
  <meta name="twitter:image:alt" content="{{ collection.featured_image.alt | default: collection.title }}">
{%- elsif template == 'index' and settings.hero_image -%}
  <meta name="twitter:image" content="{{ settings.hero_image | image_url: width: 1200, height: 630 }}">
  <meta name="twitter:image:alt" content="{{ settings.hero_title | default: shop.name }}">
{%- endif -%}

{%- comment -%} Additional SEO Meta Tags {%- endcomment -%}
<meta name="author" content="{{ shop.name }}">
<meta name="publisher" content="{{ shop.name }}">
{%- if template contains 'product' -%}
  <meta name="article:published_time" content="{{ product.created_at | date: '%Y-%m-%d' }}">
  <meta name="article:modified_time" content="{{ product.updated_at | date: '%Y-%m-%d' }}">
{%- endif -%}

{%- comment -%} JSON-LD Structured Data {%- endcomment -%}
{%- render 'structured-data' -%}